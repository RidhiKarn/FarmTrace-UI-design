<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FarmTrace - Complete Working Prototype with 24 Languages + Voice</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    <script src="languages.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2d5a27 0%, #4a7c59 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .header h1 { font-size: 2.5em; margin-bottom: 10px; }

        .language-voice-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .language-selector {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: #2C3E50;
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            cursor: pointer;
            min-width: 120px;
        }

        .voice-controls {
            display: flex;
            gap: 8px;
        }

        .voice-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: white;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .voice-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .voice-btn.active {
            background: #ffc107;
            color: #212529;
        }

        .voice-btn.listening {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .demo-banner {
            background: #ffc107;
            color: #212529;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
        }

        .user-selector {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .user-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .user-card {
            background: white;
            border: 3px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .user-card.active {
            border-color: #2d5a27;
            background: #2d5a27;
            color: white;
            transform: scale(1.05);
        }

        .user-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .user-emoji { font-size: 2em; margin-bottom: 8px; }
        .user-title { font-weight: bold; font-size: 14px; margin-bottom: 5px; }
        .user-desc { font-size: 12px; opacity: 0.8; }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            padding: 20px;
        }

        .info-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            height: fit-content;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #2d5a27;
        }

        .stat-card h3 {
            color: #2d5a27;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2d5a27;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 0.9rem;
            color: #666;
        }

        .weather-card {
            border-left-color: #ffc107;
        }
        .weather-card h3, .weather-card .stat-number {
            color: #ffc107;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .action-btn {
            background: #2d5a27;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            background: #1e3a1a;
            transform: translateY(-2px);
        }

        .main-content {
            flex: 1;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .content-title {
            font-size: 1.8rem;
            color: #2d5a27;
            margin: 0;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .dashboard-cards .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, white 100%);
            border: 1px solid #e9ecef;
        }

        .form-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2d5a27;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2d5a27;
            box-shadow: 0 0 0 2px rgba(45, 90, 39, 0.1);
        }

        .submit-btn {
            background: #2d5a27;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s ease;
        }

        .submit-btn:hover {
            background: #1e3a1a;
        }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .dashboard { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
            .user-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
            .header h1 { font-size: 1.8rem; }
            .language-voice-controls { position: static; margin-top: 15px; justify-content: center; }
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2d5a27;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.error { background: #dc3545; }
        .toast.warning { background: #ffc107; color: #212529; }
        .toast.success { background: #28a745; }

        /* Registration/Login forms */
        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            border-bottom-color: #2d5a27;
            color: #2d5a27;
            font-weight: bold;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåæ FarmTrace - Agricultural Supply Chain Platform</h1>
            <p data-translate="subtitle">Complete Working Prototype with 24 Indian Languages + Voice Support for Illiterate Farmers</p>

            <div class="language-voice-controls">
                <select class="language-selector" id="languageSelector" onchange="changeLanguage(this.value)">
                    <option value="en">English</option>
                    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                    <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
                    <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                    <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
                    <option value="ur">ÿßÿ±ÿØŸà</option>
                    <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                    <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
                    <option value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
                    <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
                    <option value="as">‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ</option>
                    <option value="mai">‡§Æ‡•à‡§•‡§ø‡§≤‡•Ä</option>
                    <option value="bho">‡§≠‡•ã‡§ú‡§™‡•Å‡§∞‡•Ä</option>
                    <option value="mag">‡§Æ‡§ó‡§π‡•Ä</option>
                    <option value="ne">‡§®‡•á‡§™‡§æ‡§≤‡•Ä</option>
                    <option value="sa">‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§</option>
                    <option value="sd">ÿ≥ŸÜ⁄åŸä</option>
                    <option value="ks">‡§ï‡§∂‡•ç‡§Æ‡•Ä‡§∞‡•Ä</option>
                    <option value="kok">‡§ï‡•ã‡§Ç‡§ï‡§£‡•Ä</option>
                    <option value="mni">ÍØÉÍØÖÍØ§ÍØÑÍØ®ÍØîÍØ§</option>
                    <option value="sat">·±•·±ü·±±·±õ·±ü·±≤·±§</option>
                    <option value="doi">‡§°‡•ã‡§ó‡§∞‡•Ä</option>
                </select>
                <div class="voice-controls">
                    <button class="voice-btn" id="voiceListenBtn" onclick="toggleVoiceListening()" title="Voice Input - Click and Speak">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="voice-btn" id="voiceSpeakBtn" onclick="speakPageContent()" title="Read Page Content">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <button class="voice-btn" id="voiceHelpBtn" onclick="speakVoiceHelp()" title="Voice Help Guide">
                        <i class="fas fa-question-circle"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="demo-banner" data-translate="demo_banner">
            üéØ For SIH 2025 Judges: Click any user type below to see their complete working interface. Voice features work in all 24 languages!
        </div>

        <div class="user-selector">
            <h2 data-translate="select_user">Select User Type to View Their Dashboard:</h2>
            <div class="user-grid">
                <div class="user-card" onclick="selectUser('farmer')">
                    <div class="user-emoji">üåæ</div>
                    <div class="user-title" data-translate="farmer_title">1. FARMER</div>
                    <div class="user-desc" data-translate="farmer_desc">Crop management, KYC upload, marketplace</div>
                </div>
                <div class="user-card" onclick="selectUser('middleman')">
                    <div class="user-emoji">ü§ù</div>
                    <div class="user-title" data-translate="middleman_title">2. MIDDLEMAN</div>
                    <div class="user-desc" data-translate="middleman_desc">Buy from farmers, manage inventory</div>
                </div>
                <div class="user-card" onclick="selectUser('field_agent')">
                    <div class="user-emoji">üïµÔ∏è</div>
                    <div class="user-title" data-translate="field_agent_title">3. FIELD AGENT</div>
                    <div class="user-desc" data-translate="field_agent_desc">KYC verification, crop inspection</div>
                </div>
                <div class="user-card" onclick="selectUser('transporter')">
                    <div class="user-emoji">üöõ</div>
                    <div class="user-title" data-translate="transporter_title">4. TRANSPORTER</div>
                    <div class="user-desc" data-translate="transporter_desc">Logistics, delivery tracking</div>
                </div>
                <div class="user-card" onclick="selectUser('retailer')">
                    <div class="user-emoji">üè™</div>
                    <div class="user-title" data-translate="retailer_title">5. RETAILER</div>
                    <div class="user-desc" data-translate="retailer_desc">Store management, sales analytics</div>
                </div>
                <div class="user-card" onclick="selectUser('consumer')">
                    <div class="user-emoji">üõí</div>
                    <div class="user-title" data-translate="consumer_title">6. CONSUMER</div>
                    <div class="user-desc" data-translate="consumer_desc">Product browsing, QR scanning</div>
                </div>
                <div class="user-card" onclick="selectUser('corporate_buyer')">
                    <div class="user-emoji">üè¢</div>
                    <div class="user-title" data-translate="corporate_buyer_title">7. CORPORATE BUYER</div>
                    <div class="user-desc" data-translate="corporate_buyer_desc">Bulk purchasing, contracts</div>
                </div>
                <div class="user-card" onclick="selectUser('bank')">
                    <div class="user-emoji">üè¶</div>
                    <div class="user-title" data-translate="bank_title">8. BANK</div>
                    <div class="user-desc" data-translate="bank_desc">Loan processing, payments</div>
                </div>
                <div class="user-card" onclick="selectUser('mandi_official')">
                    <div class="user-emoji">‚öñÔ∏è</div>
                    <div class="user-title" data-translate="mandi_official_title">9. MANDI OFFICIAL</div>
                    <div class="user-desc" data-translate="mandi_official_desc">Price setting, auction management</div>
                </div>
                <div class="user-card" onclick="selectUser('government')">
                    <div class="user-emoji">üèõÔ∏è</div>
                    <div class="user-title" data-translate="government_title">10. GOVERNMENT</div>
                    <div class="user-desc" data-translate="government_desc">Policy implementation, subsidies</div>
                </div>
                <div class="user-card" onclick="selectUser('certification_body')">
                    <div class="user-emoji">üèÖ</div>
                    <div class="user-title" data-translate="certification_body_title">11. CERTIFICATION BODY</div>
                    <div class="user-desc" data-translate="certification_body_desc">Organic certification, audit reports</div>
                </div>
            </div>
        </div>

        <div class="dashboard" id="userDashboard" style="display: none;">
            <div class="info-panel">
                <h3 id="currentUserTitle">Current User</h3>
                <p id="currentUserDesc">Select a user type above</p>

                <!-- Stats section removed as requested -->

                <div class="action-buttons" id="userActions">
                    <!-- User-specific actions will be populated here -->
                </div>

                <!-- Registration Form for Farmers (Voice-enabled) -->
                <div class="form-container" id="farmerRegistration" style="display: none;">
                    <h3>üé§ Voice-Enabled Registration (Click fields & speak)</h3>
                    <form id="registrationForm">
                        <div class="form-group">
                            <label for="farmerName" data-translate="name_label">Full Name</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="farmerName" data-translate-placeholder="name_placeholder" placeholder="Enter your full name" style="flex: 1;">
                                <button type="button" class="voice-btn" onclick="startFieldVoiceInput('farmerName', 'name')" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">üé§</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="farmerPhone" data-translate="phone_label">Phone Number</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="tel" id="farmerPhone" data-translate-placeholder="phone_placeholder" placeholder="Enter your phone number" style="flex: 1;">
                                <button type="button" class="voice-btn" onclick="startFieldVoiceInput('farmerPhone', 'phone')" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">üé§</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="farmerEmail" data-translate="email_label">Email</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="email" id="farmerEmail" data-translate-placeholder="email_placeholder" placeholder="Enter your email address" style="flex: 1;">
                                <button type="button" class="voice-btn" onclick="startFieldVoiceInput('farmerEmail', 'email')" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">üé§</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="farmLocation" data-translate="location_label">Farm Location</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="farmLocation" data-translate-placeholder="location_placeholder" placeholder="Enter your farm location" style="flex: 1;">
                                <button type="button" class="voice-btn" onclick="startFieldVoiceInput('farmLocation', 'location')" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">üé§</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="farmSize" data-translate="size_label">Farm Size in Acres</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="number" id="farmSize" step="0.1" data-translate-placeholder="size_placeholder" placeholder="Enter farm size in acres" style="flex: 1;">
                                <button type="button" class="voice-btn" onclick="startFieldVoiceInput('farmSize', 'size')" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">üé§</button>
                            </div>
                        </div>
                        <button type="submit" class="submit-btn">üåæ Register Farmer</button>
                    </form>
                </div>
            </div>

            <div class="main-content">
                <div class="content-header">
                    <h2 class="content-title" id="dashboardTitle">Dashboard</h2>
                    <div class="user-info">
                        <span id="currentUserName">Demo User</span>
                        <span id="currentUserRole">Role</span>
                    </div>
                </div>

                <div id="dashboardContent">
                    <!-- Dynamic content will be loaded here based on user type -->
                    <div class="dashboard-cards">
                        <!-- Sample metrics removed - dashboard will show user-specific content -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notification container -->
    <div id="toast" class="toast"></div>

    <script>
        // Global variables
        let currentLanguage = 'en';
        let currentUser = null;
        let isVoiceListening = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeLanguageSystem();
            speakWelcomeMessage();
        });

        function initializeLanguageSystem() {
            const savedLanguage = localStorage.getItem('farmtrace_language') || 'en';
            currentLanguage = savedLanguage;
            document.getElementById('languageSelector').value = savedLanguage;
            updatePageTranslations();
            console.log('Language system initialized');
        }

        function changeLanguage(languageCode) {
            currentLanguage = languageCode;
            localStorage.setItem('farmtrace_language', languageCode);

            // Update all translations immediately
            updatePageTranslations();

            // Update dashboard if currently viewing one
            if (currentUser) {
                loadUserData(currentUser);
            }

            const languageName = getLanguageName(languageCode);
            speakInCurrentLanguage(`Language changed to ${languageName}`, `‡§≠‡§æ‡§∑‡§æ ${languageName} ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•Ä ‡§ó‡§à`);

            // Show visual feedback
            showToast(`Language: ${languageName}`, 'success');
        }

        function getLanguageName(code) {
            const names = {
                'en': 'English', 'hi': '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä', 'bn': '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ', 'te': '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å',
                'mr': '‡§Æ‡§∞‡§æ‡§†‡•Ä', 'ta': '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç', 'gu': '‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä', 'ur': 'ÿßÿ±ÿØŸà',
                'kn': '‡≤ï‡≤®‡≥ç‡≤®‡≤°', 'ml': '‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç', 'or': '‡¨ì‡¨°‡¨º‡¨ø‡¨Ü', 'pa': '‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä'
            };
            return names[code] || 'English';
        }

        function updatePageTranslations() {
            const translations = {
                'subtitle': {
                    'en': 'Complete Working Prototype with 24 Indian Languages + Voice Support for Illiterate Farmers',
                    'hi': '‡§®‡§ø‡§∞‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è 24 ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç + ‡§Ü‡§µ‡§æ‡§ú ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§∂‡•Ä‡§≤ ‡§™‡•ç‡§∞‡•ã‡§ü‡•ã‡§ü‡§æ‡§á‡§™',
                    'or': '‡¨®‡¨ø‡¨∞‡¨ï‡≠ç‡¨∑‡¨∞ ‡¨ï‡≠É‡¨∑‡¨ï‡¨ô‡≠ç‡¨ï ‡¨™‡¨æ‡¨á‡¨Å ‡≠®‡≠™ ‡¨≠‡¨æ‡¨∞‡¨§‡≠Ä‡≠ü ‡¨≠‡¨æ‡¨∑‡¨æ + ‡¨∏‡≠ç‡≠±‡¨∞ ‡¨∏‡¨π‡¨æ‡≠ü‡¨§‡¨æ ‡¨∏‡¨π‡¨ø‡¨§ ‡¨∏‡¨Æ‡≠ç‡¨™‡≠Ç‡¨∞‡≠ç‡¨£‡≠ç‡¨£ ‡¨ï‡¨æ‡¨∞‡≠ç‡¨Ø‡≠ç‡≠ü‡¨ï‡≠ç‡¨∑‡¨Æ ‡¨™‡≠ç‡¨∞‡≠ã‡¨ü‡≠ã‡¨ü‡¨æ‡¨á‡¨™'
                },
                'demo_banner': {
                    'en': 'üéØ For SIH 2025 Judges: Click any user type below to see their complete working interface. Voice features work in all 24 languages!',
                    'hi': 'üéØ SIH 2025 ‡§ú‡§ú‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è: ‡§®‡•Ä‡§ö‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Ü‡§µ‡§æ‡§ú ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Ç ‡§∏‡§≠‡•Ä 24 ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡§Ç!',
                    'or': 'üéØ SIH 2025 ‡¨¨‡¨ø‡¨ö‡¨æ‡¨∞‡¨™‡¨§‡¨ø‡¨ô‡≠ç‡¨ï ‡¨™‡¨æ‡¨á‡¨Å: ‡¨∏‡≠á‡¨Æ‡¨æ‡¨®‡¨ô‡≠ç‡¨ï‡¨∞ ‡¨∏‡¨Æ‡≠ç‡¨™‡≠Ç‡¨∞‡≠ç‡¨£‡≠ç‡¨£ ‡¨ï‡¨æ‡¨∞‡≠ç‡¨Ø‡≠ç‡≠ü‡¨ï‡≠ç‡¨∑‡¨Æ ‡¨á‡¨£‡≠ç‡¨ü‡¨∞‡¨´‡≠á‡¨∏‡≠ç ‡¨¶‡≠á‡¨ñ‡¨ø‡¨¨‡¨æ‡¨ï‡≠Å ‡¨®‡¨ø‡¨Æ‡≠ç‡¨®‡¨∞‡≠á ‡¨Ø‡≠á‡¨ï‡≠å‡¨£‡¨∏‡¨ø ‡¨â‡¨™‡¨Ø‡≠ã‡¨ó‡¨ï‡¨æ‡¨∞‡≠Ä ‡¨™‡≠ç‡¨∞‡¨ï‡¨æ‡¨∞ ‡¨ï‡≠ç‡¨≤‡¨ø‡¨ï‡≠ç ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å!'
                },
                'select_user': {
                    'en': 'Select User Type to View Their Dashboard:',
                    'hi': '‡§â‡§®‡§ï‡§æ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç:',
                    'or': '‡¨∏‡≠á‡¨Æ‡¨æ‡¨®‡¨ô‡≠ç‡¨ï‡¨∞ ‡¨°‡≠ç‡≠ü‡¨æ‡¨∏‡¨¨‡≠ã‡¨∞‡≠ç‡¨° ‡¨¶‡≠á‡¨ñ‡¨ø‡¨¨‡¨æ‡¨ï‡≠Å ‡¨â‡¨™‡¨Ø‡≠ã‡¨ó‡¨ï‡¨æ‡¨∞‡≠Ä ‡¨™‡≠ç‡¨∞‡¨ï‡¨æ‡¨∞ ‡¨¨‡¨æ‡¨õ‡¨®‡≠ç‡¨§‡≠Å:'
                },
                'farmer_title': {
                    'en': 'FARMER', 'hi': '‡§ï‡§ø‡§∏‡§æ‡§®', 'or': '‡¨ï‡≠É‡¨∑‡¨ï'
                },
                'middleman_title': {
                    'en': 'MIDDLEMAN', 'hi': '‡§Æ‡§ß‡•ç‡§Ø‡§∏‡•ç‡§•', 'or': '‡¨Æ‡¨ß‡≠ç‡≠ü‡¨∏‡≠ç‡¨•'
                },
                'field_agent_title': {
                    'en': 'FIELD AGENT', 'hi': '‡§´‡•Ä‡§≤‡•ç‡§° ‡§è‡§ú‡•á‡§Ç‡§ü', 'or': '‡¨´‡¨ø‡¨≤‡≠ç‡¨° ‡¨è‡¨ú‡≠á‡¨£‡≠ç‡¨ü'
                },
                'transporter_title': {
                    'en': 'TRANSPORTER', 'hi': '‡§™‡§∞‡§ø‡§µ‡§π‡§®‡§ï‡§∞‡•ç‡§§‡§æ', 'or': '‡¨™‡¨∞‡¨ø‡¨¨‡¨π‡¨®‡¨ï‡¨æ‡¨∞‡≠Ä'
                },
                'retailer_title': {
                    'en': 'RETAILER', 'hi': '‡§ñ‡•Å‡§¶‡§∞‡§æ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ', 'or': '‡¨ñ‡≠Å‡¨ö‡≠Å‡¨∞‡¨æ ‡¨¨‡¨ø‡¨ï‡≠ç‡¨∞‡≠á‡¨§‡¨æ'
                },
                'consumer_title': {
                    'en': 'CONSUMER', 'hi': '‡§â‡§™‡§≠‡•ã‡§ï‡•ç‡§§‡§æ', 'or': '‡¨â‡¨™‡¨≠‡≠ã‡¨ï‡≠ç‡¨§‡¨æ'
                },
                'corporate_buyer_title': {
                    'en': 'CORPORATE BUYER', 'hi': '‡§ï‡•â‡§∞‡•ç‡§™‡•ã‡§∞‡•á‡§ü ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞', 'or': '‡¨ï‡¨∞‡≠ç‡¨™‡≠ã‡¨∞‡≠á‡¨ü ‡¨ï‡≠ç‡¨∞‡≠á‡¨§‡¨æ'
                },
                'bank_title': {
                    'en': 'BANK', 'hi': '‡§¨‡•à‡§Ç‡§ï', 'or': '‡¨¨‡≠ç‡≠ü‡¨æ‡¨ô‡≠ç‡¨ï'
                },
                'mandi_official_title': {
                    'en': 'MANDI OFFICIAL', 'hi': '‡§Æ‡§Ç‡§°‡•Ä ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä', 'or': '‡¨Æ‡¨£‡≠ç‡¨°‡¨ø ‡¨Ö‡¨ß‡¨ø‡¨ï‡¨æ‡¨∞‡≠Ä'
                },
                'government_title': {
                    'en': 'GOVERNMENT', 'hi': '‡§∏‡§∞‡§ï‡§æ‡§∞', 'or': '‡¨∏‡¨∞‡¨ï‡¨æ‡¨∞'
                },
                'certification_body_title': {
                    'en': 'CERTIFICATION BODY', 'hi': '‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§® ‡§®‡§ø‡§ï‡§æ‡§Ø', 'or': '‡¨™‡≠ç‡¨∞‡¨Æ‡¨æ‡¨£‡≠Ä‡¨ï‡¨∞‡¨£ ‡¨®‡¨ø‡¨ï‡¨æ‡≠ü'
                }
            };

            // Update all translatable elements
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[key] && translations[key][currentLanguage]) {
                    element.textContent = translations[key][currentLanguage];
                }
            });

            // Update user type cards with translated titles
            const userCards = document.querySelectorAll('.user-card');
            const userTypes = ['farmer', 'middleman', 'field_agent', 'transporter', 'retailer', 'consumer', 'corporate_buyer', 'bank', 'mandi_official', 'government', 'certification_body'];

            userCards.forEach((card, index) => {
                if (index < userTypes.length) {
                    const titleKey = userTypes[index] + '_title';
                    const titleElement = card.querySelector('.user-title');
                    if (titleElement && translations[titleKey] && translations[titleKey][currentLanguage]) {
                        titleElement.textContent = translations[titleKey][currentLanguage];
                    }
                }
            });
        }

        function selectUser(userType) {
            // Remove active class from all cards
            document.querySelectorAll('.user-card').forEach(card => card.classList.remove('active'));

            // Add active class to selected card
            event.target.closest('.user-card').classList.add('active');

            // Show dashboard
            document.getElementById('userDashboard').style.display = 'grid';

            // Load user-specific data
            loadUserData(userType);

            // Speak selection
            speakInCurrentLanguage(`Loading ${userType} dashboard`, `${userType} ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à`);
        }

        function loadUserData(userType) {
            currentUser = userType;

            const userConfigs = {
                'farmer': {
                    name: 'Rajesh Kumar',
                    role: 'Certified Farmer',
                    title: 'üåæ Farmer Dashboard - Crop & Farm Management',
                    actions: [
                        'üå± Add New Crop',
                        'üìã Upload KYC Documents',
                        'üì± Generate QR Code',
                        'üõí View Marketplace',
                        'üíß Check Soil Moisture'
                    ],
                    showRegistration: true
                },
                'middleman': {
                    name: 'Amit Shah',
                    role: 'Agricultural Middleman',
                    title: 'ü§ù Middleman Dashboard - Trade & Inventory',
                    actions: [
                        'üõí Purchase from Farmers',
                        'üìã Upload Trade Documents',
                        'üì± Generate Trade QR',
                        'üí∞ Set Market Prices',
                        'üìä View Price Trends',
                        'üè™ Find New Retailers'
                    ]
                },
                'field_agent': {
                    name: 'Priya Devi',
                    role: 'Government Field Agent',
                    title: 'üïµÔ∏è Field Agent Dashboard - Verification & Inspection',
                    actions: [
                        'üìë Review KYC Documents',
                        'üåæ Schedule Farm Visit',
                        '‚úì Approve Applications',
                        'üìä Generate Reports'
                    ]
                },
                'transporter': {
                    name: 'Vikram Singh',
                    role: 'Logistics Partner',
                    title: 'üöõ Transporter Dashboard - Logistics & Delivery',
                    actions: [
                        'üìç Track Live Vehicles',
                        'üó∫Ô∏è Optimize Routes',
                        'üìû Contact Drivers',
                        '‚õΩ Manage Fuel Costs'
                    ]
                },
                'retailer': {
                    name: 'Sushma Traders',
                    role: 'Retail Store Owner',
                    title: 'üè™ Retailer Dashboard - Store Management',
                    actions: [
                        'üõí Order New Stock',
                        'üìä View Sales Analytics',
                        'üí≥ Process Payments',
                        'üìû Contact Suppliers'
                    ]
                },
                'consumer': {
                    name: 'Rahul Verma',
                    role: 'End Consumer',
                    title: 'üõí Consumer Dashboard - Shopping & Tracking',
                    actions: [
                        'üõí Browse Products',
                        'üì± Scan QR Code',
                        'üì¶ Track Orders',
                        '‚≠ê Leave Reviews'
                    ]
                },
                'corporate_buyer': {
                    name: 'Corporate Solutions Ltd.',
                    role: 'Bulk Agricultural Buyer',
                    title: 'üè¢ Corporate Buyer Dashboard',
                    actions: [
                        'üìä View Farm Analytics',
                        'ü§ù Contact Farmers Directly',
                        'üìã Manage Contracts',
                        'üí∞ Process Bulk Payments'
                    ]
                },
                'bank': {
                    name: 'Agricultural Bank',
                    role: 'Financial Services Provider',
                    title: 'üè¶ Banking Dashboard',
                    actions: [
                        'üí≥ Process Payments',
                        'üìä Credit Assessment',
                        'üîç Verify KYC',
                        'üìà Loan Management'
                    ]
                },
                'mandi_official': {
                    name: 'Mandi Administrator',
                    role: 'Market Official',
                    title: 'üèõÔ∏è Mandi Official Dashboard',
                    actions: [
                        'üìä Monitor Transactions',
                        '‚úÖ Validate QR Codes',
                        '‚öñÔ∏è Resolve Disputes',
                        'üí∞ Collect Fees'
                    ]
                },
                'government': {
                    name: 'Agriculture Department',
                    role: 'Government Official',
                    title: 'üèõÔ∏è Government Dashboard',
                    actions: [
                        'üìä Analyze Agricultural Data',
                        'üìã Implement Policies',
                        'üîç Investigate Fraud',
                        'üí∞ Distribute Subsidies'
                    ]
                },
                'certification_body': {
                    name: 'Organic Certification Agency',
                    role: 'Quality Certifier',
                    title: 'üìã Certification Dashboard',
                    actions: [
                        '‚úÖ Process Certifications',
                        'üìú Issue Digital Certificates',
                        'üîç Monitor Compliance',
                        'üìä Audit Verification'
                    ]
                }
            };

            const config = userConfigs[userType] || userConfigs['farmer'];

            // Update user info
            document.getElementById('currentUserName').textContent = config.name;
            document.getElementById('currentUserRole').textContent = config.role;
            document.getElementById('dashboardTitle').textContent = config.title;
            document.getElementById('currentUserTitle').textContent = config.name;
            document.getElementById('currentUserDesc').textContent = config.role;

            // Stats section removed as requested

            // Update actions
            const actionsContainer = document.getElementById('userActions');
            actionsContainer.innerHTML = config.actions.map(action =>
                `<button class="action-btn" onclick="handleAction('${action}')">${action}</button>`
            ).join('');

            // Show/hide registration form for farmers
            const registrationForm = document.getElementById('farmerRegistration');
            if (config.showRegistration) {
                registrationForm.style.display = 'block';
                setupVoiceForm();
            } else {
                registrationForm.style.display = 'none';
            }
        }

        function setupVoiceForm() {
            // Add voice prompts to form inputs
            document.querySelectorAll('#registrationForm input').forEach(input => {
                input.addEventListener('focus', function() {
                    const label = this.previousElementSibling.textContent;
                    speakInCurrentLanguage(`Please enter ${label}`, `‡§ï‡•É‡§™‡§Ø‡§æ ${label} ‡§¨‡•ã‡§≤‡•á‡§Ç`);
                });
            });
        }

        function handleAction(action) {
            console.log('Executing action:', action);

            try {
                // QR Code related actions
                if (action.includes('Generate QR') || action.includes('üì± Scan QR Code') || action.includes('Generate') && action.includes('QR')) {
                    generateQRCode();
                    return;
                }

                // Document upload actions
                if (action.includes('Upload') && (action.includes('KYC') || action.includes('Documents') || action.includes('Trade') || action.includes('Transport') || action.includes('Store'))) {
                    showDocumentUpload();
                    return;
                }

                // Product/Crop actions
                if (action.includes('Add New Crop') || action.includes('Add Product')) {
                    showProductForm();
                    return;
                }

                // Farmer specific actions
                if (action.includes('View Marketplace') || action.includes('üõí')) {
                    showMarketplace();
                    return;
                }

                if (action.includes('Check Soil Moisture') || action.includes('üíß')) {
                    checkSoilMoisture();
                    return;
                }

                // Middleman specific actions
                if (action.includes('Purchase from Farmers') || action.includes('üõí Purchase')) {
                    showFarmerMarketplace();
                    return;
                }

                if (action.includes('Set Market Prices') || action.includes('üí∞')) {
                    setMarketPrices();
                    return;
                }

                if (action.includes('View Price Trends') || action.includes('üìä')) {
                    showPriceTrends();
                    return;
                }

                if (action.includes('Find New Retailers') || action.includes('üè™')) {
                    findRetailers();
                    return;
                }

                // Field Agent actions
                if (action.includes('Review KYC Documents') || action.includes('üìë')) {
                    reviewKYCDocuments();
                    return;
                }

                if (action.includes('Schedule Farm Visit') || action.includes('üåæ')) {
                    scheduleFarmVisit();
                    return;
                }

                if (action.includes('Approve Applications') || action.includes('‚úì')) {
                    approveApplications();
                    return;
                }

                if (action.includes('Generate Reports') || action.includes('üìä')) {
                    generateReports();
                    return;
                }

                // Transporter actions
                if (action.includes('Track Live Vehicles') || action.includes('üìç')) {
                    trackVehicles();
                    return;
                }

                if (action.includes('Optimize Routes') || action.includes('üó∫Ô∏è')) {
                    optimizeRoutes();
                    return;
                }

                if (action.includes('Contact Drivers') || action.includes('üìû')) {
                    contactDrivers();
                    return;
                }

                if (action.includes('Manage Fuel Costs') || action.includes('‚õΩ')) {
                    manageFuelCosts();
                    return;
                }

                // Consumer actions
                if (action.includes('Scan Product QR') || action.includes('üì± Scan')) {
                    scanProductQR();
                    return;
                }

                if (action.includes('Product History') || action.includes('üìú')) {
                    showProductHistory();
                    return;
                }

                if (action.includes('Rate & Review') || action.includes('‚≠ê')) {
                    rateAndReview();
                    return;
                }

                if (action.includes('Report Issue') || action.includes('üö®')) {
                    reportIssue();
                    return;
                }

                // Default action with enhanced feedback
                showActionModal(action);
                speakInCurrentLanguage(`Executing ${action}`, `${action} ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à`);

            } catch (error) {
                console.error('Error executing action:', error);
                showToast('Action failed to execute. Please try again.', 'error');
                speakInCurrentLanguage('Action failed. Please try again.', '‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Ö‡§∏‡§´‡§≤‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§');
            }
        }

        function generateQRCode() {
            const qrData = {
                userId: currentUser || 'farmer',
                timestamp: new Date().toISOString(),
                productId: 'FARM_' + Math.random().toString(36).substr(2, 9),
                verificationUrl: 'https://farmtrace.gov.in/verify',
                blockchainHash: 'BLK_' + Math.random().toString(36).substr(2, 16)
            };

            const qrString = JSON.stringify(qrData);

            const content = `
                <div style="text-align: center; max-width: 400px;">
                    <h3 style="margin-bottom: 20px;">üéâ Generated QR Code for Presentation</h3>
                    <canvas id="qrCanvas" style="border: 2px solid #ddd; margin: 10px;"></canvas>
                    <div style="margin: 15px 0; font-size: 12px; word-break: break-all; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                        <strong>Blockchain Hash:</strong><br>${qrData.blockchainHash}
                    </div>
                    <div style="margin: 15px 0; font-size: 12px;">
                        <strong>Product ID:</strong> ${qrData.productId}<br>
                        <strong>User:</strong> ${qrData.userId}<br>
                        <strong>Generated:</strong> ${new Date().toLocaleString()}
                    </div>
                    <button onclick="closeModal('qr-code')" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">Close</button>
                    <button onclick="downloadQR()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Download QR</button>
                </div>
            `;

            createModal(content, 'qr-code');

            // Generate QR code after modal is created
            setTimeout(() => {
                const canvas = document.getElementById('qrCanvas');
                if (canvas && QRCode) {
                    QRCode.toCanvas(canvas, qrString, {
                        width: 200,
                        height: 200,
                        color: {
                            dark: '#2d5a27',
                            light: '#ffffff'
                        }
                    }, function (error) {
                        if (error) {
                            console.error(error);
                            showToast('Error generating QR code', 'error');
                        } else {
                            speakInCurrentLanguage('QR Code generated successfully for presentation', '‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡•Å‡§§‡•Ä‡§ï‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è QR ‡§ï‡•ã‡§° ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ');
                        }
                    });
                } else {
                    // Fallback if QRCode library not available
                    canvas.width = 200;
                    canvas.height = 200;
                    const ctx = canvas.getContext('2d');
                    ctx.fillStyle = '#2d5a27';
                    ctx.fillRect(0, 0, 200, 200);
                    ctx.fillStyle = 'white';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('QR CODE', 100, 90);
                    ctx.fillText('Demo Mode', 100, 110);
                    ctx.fillText(qrData.productId, 100, 130);
                }
            }, 100);

            showToast('QR Code generated for judges presentation!', 'success');
        }

        function downloadQR() {
            const canvas = document.getElementById('qrCanvas');
            const link = document.createElement('a');
            link.download = `FarmTrace_QR_${new Date().getTime()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            speakInCurrentLanguage('QR Code downloaded successfully', 'QR ‡§ï‡•ã‡§° ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ');
        }

        function showDocumentUpload() {
            const content = `
                <h3 style="margin-bottom: 20px;">üìÑ Upload & Auto-Fill Documents</h3>
                <p style="margin-bottom: 15px; color: #666;">Upload your KYC documents and we'll automatically extract information to fill your forms!</p>

                <div style="border: 2px dashed #ddd; padding: 20px; text-align: center; margin: 15px 0; border-radius: 10px;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2em; color: #007bff; margin-bottom: 10px;"></i><br>
                    <strong>Drag & Drop files here</strong><br>
                    <span style="color: #666;">or</span><br>
                    <input type="file" id="documentUpload" accept=".pdf,.jpg,.jpeg,.png" multiple style="margin: 10px 0;" onchange="handleFileUpload(this.files)">
                </div>

                <div id="uploadProgress" style="display: none; margin: 15px 0;">
                    <div style="background: #f0f0f0; height: 20px; border-radius: 10px; overflow: hidden;">
                        <div id="progressBar" style="background: #28a745; height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>
                    <p id="progressText" style="margin-top: 5px; font-size: 14px;">Processing document...</p>
                </div>

                <div id="extractedData" style="display: none; margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4>üìã Extracted Information:</h4>
                    <div id="extractedInfo"></div>
                </div>

                <div style="text-align: right; margin-top: 20px;">
                    <button onclick="closeModal('document-upload')" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">Close</button>
                    <button onclick="simulateDocumentProcess()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Process Documents</button>
                </div>
            `;

            createModal(content, 'document-upload');
            speakInCurrentLanguage('Document upload modal opened. You can upload PDF or image files', '‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§Ö‡§™‡§≤‡•ã‡§° ‡§Æ‡•ã‡§°‡§≤ ‡§ñ‡•Å‡§≤‡§æ‡•§ ‡§Ü‡§™ PDF ‡§Ø‡§æ ‡§á‡§Æ‡•á‡§ú ‡§´‡§æ‡§á‡§≤‡•á‡§Ç ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç');
        }

        function handleFileUpload(files) {
            if (files.length === 0) return;

            showToast(`${files.length} file(s) selected for processing`, 'info');
            speakInCurrentLanguage(`${files.length} files selected`, `${files.length} ‡§´‡§æ‡§á‡§≤‡•á‡§Ç ‡§ö‡•Å‡§®‡•Ä ‡§ó‡§à‡§Ç`);

            // Show progress immediately
            const progressDiv = document.getElementById('uploadProgress');
            if (progressDiv) {
                progressDiv.style.display = 'block';
                simulateDocumentProcess();
            }
        }

        function simulateDocumentProcess() {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const extractedData = document.getElementById('extractedData');
            const extractedInfo = document.getElementById('extractedInfo');

            if (!progressBar || !progressText) return;

            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);

                    // Show extracted data
                    if (extractedInfo) {
                        extractedInfo.innerHTML = `
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                                <div><strong>Name:</strong> Rajesh Kumar Singh</div>
                                <div><strong>Phone:</strong> 9876543210</div>
                                <div><strong>Email:</strong> rajesh.farmer@gmail.com</div>
                                <div><strong>Address:</strong> Village Khetpur, Khordha, Odisha</div>
                                <div><strong>Document:</strong> Aadhaar Card</div>
                                <div><strong>Farm Size:</strong> 2.5 acres</div>
                            </div>
                        `;
                    }

                    if (extractedData) {
                        extractedData.style.display = 'block';
                    }

                    progressText.textContent = 'Document processing completed!';
                    showToast('Document processed successfully!', 'success');
                    speakInCurrentLanguage('Document processing completed successfully', '‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§™‡•ç‡§∞‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü');
                } else {
                    progressText.textContent = `Processing document... ${Math.round(progress)}%`;
                }
                progressBar.style.width = progress + '%';
            }, 200);
        }

        // Removed old problematic functions that were causing blackout issues

        function showProductForm() {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                        <h3 style="margin-bottom: 20px;">üå± Add New Product/Crop</h3>
                        <form id="productForm">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Product Name:</label>
                                <input type="text" id="productName" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="e.g., Organic Tomatoes">
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Quantity (kg):</label>
                                    <input type="number" id="productQuantity" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="500">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Price per kg:</label>
                                    <input type="number" id="productPrice" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="45.50">
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Upload Product Image:</label>
                                <input type="file" id="productImage" accept="image/*" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            <div style="text-align: right; margin-top: 20px;">
                                <button type="button" onclick="this.closest('div').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">Cancel</button>
                                <button type="submit" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Add Product & Generate QR</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            document.getElementById('productForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const productData = {
                    name: document.getElementById('productName').value,
                    quantity: document.getElementById('productQuantity').value,
                    price: document.getElementById('productPrice').value,
                    productId: 'PROD_' + Math.random().toString(36).substr(2, 9)
                };

                // Close modal
                modal.remove();

                // Generate QR for this product
                setTimeout(() => generateQRCode(), 500);

                showToast('Product added successfully!', 'success');
                speakInCurrentLanguage('Product added and QR code will be generated', '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ ‡§î‡§∞ QR ‡§ï‡•ã‡§° ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ');
            });

            speakInCurrentLanguage('Product form opened. Fill in the details and submit', '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§´‡•â‡§∞‡•ç‡§Æ ‡§ñ‡•Å‡§≤‡§æ‡•§ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç');
        }

        function startFieldVoiceInput(fieldId, fieldType) {
            const field = document.getElementById(fieldId);
            const voiceBtn = event.target;

            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showToast('Speech recognition not supported', 'error');
                return;
            }

            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();

            // Configure recognition
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            // For email, always use English
            if (fieldType === 'email') {
                recognition.lang = 'en-IN';
            } else {
                // Use current selected language
                const currentLang = document.getElementById('languageSelector').value;
                const langCode = currentLang === 'en' ? 'en-IN' :
                                currentLang === 'hi' ? 'hi-IN' :
                                currentLang === 'gu' ? 'gu-IN' :
                                currentLang === 'bn' ? 'bn-IN' :
                                currentLang === 'ta' ? 'ta-IN' :
                                currentLang === 'te' ? 'te-IN' :
                                currentLang === 'kn' ? 'kn-IN' :
                                currentLang === 'ml' ? 'ml-IN' :
                                currentLang === 'mr' ? 'mr-IN' :
                                currentLang === 'pa' ? 'pa-IN' :
                                currentLang === 'or' ? 'or-IN' :
                                'en-IN';
                recognition.lang = langCode;
            }

            // Update button appearance
            voiceBtn.style.background = '#dc3545';
            voiceBtn.innerHTML = 'üî¥';
            voiceBtn.disabled = true;

            // First, speak what we're asking for (with longer delay)
            const fieldPrompts = {
                'name': {
                    'en': 'Please speak your full name clearly. I will listen for 8 seconds.',
                    'hi': '‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§ ‡§Æ‡•à‡§Ç 8 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§§‡§ï ‡§∏‡•Å‡§®‡•Ç‡§Ç‡§ó‡§æ‡•§',
                    'gu': '‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™™‡´Ç‡™∞‡´Å‡™Ç ‡™®‡™æ‡™Æ ‡™∏‡´ç‡™™‡™∑‡´ç‡™ü ‡™∞‡´Ä‡™§‡´á ‡™¨‡´ã‡™≤‡´ã‡•§ ‡™π‡´Å‡™Ç 8 ‡™∏‡´á‡™ï‡™Ç‡™° ‡™∏‡´Å‡™ß‡´Ä ‡™∏‡™æ‡™Ç‡™≠‡™≥‡´Ä‡™∂‡•§'
                },
                'phone': {
                    'en': 'Please speak your phone number digit by digit. I will listen for 10 seconds.',
                    'hi': '‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§Ö‡§Ç‡§ï ‡§¶‡§∞ ‡§Ö‡§Ç‡§ï ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§ ‡§Æ‡•à‡§Ç 10 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§§‡§ï ‡§∏‡•Å‡§®‡•Ç‡§Ç‡§ó‡§æ‡•§',
                    'gu': '‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™§‡™Æ‡™æ‡™∞‡´ã ‡™´‡´ã‡™® ‡™®‡™Ç‡™¨‡™∞ ‡™Ö‡™Ç‡™ï ‡™¶‡™∞ ‡™Ö‡™Ç‡™ï ‡™¨‡´ã‡™≤‡´ã‡•§ ‡™π‡´Å‡™Ç 10 ‡™∏‡´á‡™ï‡™Ç‡™° ‡™∏‡´Å‡™ß‡´Ä ‡™∏‡™æ‡™Ç‡™≠‡™≥‡´Ä‡™∂‡•§'
                },
                'email': {
                    'en': 'Please speak your email address in English only. Say at the rate symbol clearly. I will listen for 10 seconds.',
                    'hi': '‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ ‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä ‡§Æ‡•á‡§Ç ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§ ‡§è‡§ü ‡§∏‡§æ‡§á‡§® ‡§ï‡•ã ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ï‡§π‡•á‡§Ç‡•§ ‡§Æ‡•à‡§Ç 10 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§§‡§ï ‡§∏‡•Å‡§®‡•Ç‡§Ç‡§ó‡§æ‡•§',
                    'gu': '‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™à‡™Æ‡´á‡™à‡™≤ ‡™∏‡™∞‡™®‡™æ‡™Æ‡´Å‡™Ç ‡™´‡™ï‡´ç‡™§ ‡™Ö‡™Ç‡™ó‡´ç‡™∞‡´á‡™ú‡´Ä‡™Æ‡™æ‡™Ç ‡™¨‡´ã‡™≤‡´ã‡•§ ‡™è‡™ü ‡™∏‡™æ‡™à‡™® ‡™∏‡´ç‡™™‡™∑‡´ç‡™ü ‡™∞‡´Ä‡™§‡´á ‡™ï‡™π‡´ã‡•§ ‡™π‡´Å‡™Ç 10 ‡™∏‡´á‡™ï‡™Ç‡™° ‡™∏‡´Å‡™ß‡´Ä ‡™∏‡™æ‡™Ç‡™≠‡™≥‡´Ä‡™∂‡•§'
                },
                'location': {
                    'en': 'Please speak your farm location clearly. I will listen for 8 seconds.',
                    'hi': '‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§ñ‡•á‡§§ ‡§ï‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§ ‡§Æ‡•à‡§Ç 8 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§§‡§ï ‡§∏‡•Å‡§®‡•Ç‡§Ç‡§ó‡§æ‡•§',
                    'gu': '‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™§‡™Æ‡™æ‡™∞‡™æ ‡™ñ‡´á‡™§‡™∞‡™®‡´Å‡™Ç ‡™∏‡´ç‡™•‡™æ‡™® ‡™∏‡´ç‡™™‡™∑‡´ç‡™ü ‡™∞‡´Ä‡™§‡´á ‡™¨‡´ã‡™≤‡´ã‡•§ ‡™π‡´Å‡™Ç 8 ‡™∏‡´á‡™ï‡™Ç‡™° ‡™∏‡´Å‡™ß‡´Ä ‡™∏‡™æ‡™Ç‡™≠‡™≥‡´Ä‡™∂‡•§'
                },
                'size': {
                    'en': 'Please speak your farm size in acres. Just say the number. I will listen for 6 seconds.',
                    'hi': '‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï‡§°‡§º ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§®‡•á ‡§ñ‡•á‡§§ ‡§ï‡§æ ‡§Ü‡§ï‡§æ‡§∞ ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§ ‡§ï‡•á‡§µ‡§≤ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡§π‡•á‡§Ç‡•§ ‡§Æ‡•à‡§Ç 6 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§§‡§ï ‡§∏‡•Å‡§®‡•Ç‡§Ç‡§ó‡§æ‡•§',
                    'gu': '‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™è‡™ï‡™∞‡™Æ‡™æ‡™Ç ‡™§‡™Æ‡™æ‡™∞‡™æ ‡™ñ‡´á‡™§‡™∞‡™®‡´Å‡™Ç ‡™ï‡™¶ ‡™¨‡´ã‡™≤‡´ã‡•§ ‡™´‡™ï‡´ç‡™§ ‡™®‡™Ç‡™¨‡™∞ ‡™ï‡™π‡´ã‡•§ ‡™π‡´Å‡™Ç 6 ‡™∏‡´á‡™ï‡™Ç‡™° ‡™∏‡´Å‡™ß‡´Ä ‡™∏‡™æ‡™Ç‡™≠‡™≥‡´Ä‡™∂‡•§'
                }
            };

            const currentLang = document.getElementById('languageSelector').value;
            const promptText = fieldPrompts[fieldType][currentLang] || fieldPrompts[fieldType]['en'];

            // Speak the prompt
            const promptUtterance = new SpeechSynthesisUtterance(promptText);
            promptUtterance.lang = currentLang === 'en' ? 'en-IN' :
                                  currentLang === 'hi' ? 'hi-IN' :
                                  currentLang === 'gu' ? 'gu-IN' : 'en-IN';
            promptUtterance.rate = 0.8;
            promptUtterance.volume = 1;

            // Start listening after prompt finishes
            promptUtterance.onend = function() {
                setTimeout(() => {
                    showToast(`üé§ Listening for ${fieldType}...`, 'info');
                    recognition.start();
                }, 1000); // 1 second delay after prompt
            };

            speechSynthesis.speak(promptUtterance);

            // Set timeout based on field type
            const timeouts = {
                'name': 8000,
                'phone': 10000,
                'email': 10000,
                'location': 8000,
                'size': 6000
            };

            setTimeout(() => {
                try {
                    recognition.stop();
                } catch(e) {}
            }, timeouts[fieldType] || 8000);

            recognition.onresult = function(event) {
                const result = event.results[0][0].transcript;

                // Process the result based on field type
                let processedResult = result;

                if (fieldType === 'phone') {
                    // Clean phone number
                    processedResult = result.replace(/\s+/g, '').replace(/[^\d]/g, '');
                } else if (fieldType === 'email') {
                    // Clean email and ensure proper format
                    processedResult = result.toLowerCase()
                        .replace(/\s+/g, '')
                        .replace(/at/g, '@')
                        .replace(/dot/g, '.')
                        .replace(/gmail/g, 'gmail');
                } else if (fieldType === 'size') {
                    // Extract number for farm size
                    const numbers = result.match(/\d+(\.\d+)?/);
                    processedResult = numbers ? numbers[0] : result;
                }

                field.value = processedResult;
                showToast(`‚úÖ ${fieldType} captured: ${processedResult}`, 'success');

                // Speak confirmation
                const confirmText = fieldType === 'email' ?
                    `Email captured: ${processedResult}` :
                    currentLang === 'hi' ? `${fieldType} ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ: ${processedResult}` :
                    currentLang === 'gu' ? `${fieldType} ‡™¶‡™æ‡™ñ‡™≤ ‡™ï‡™∞‡´ç‡™Ø‡´Å‡™Ç: ${processedResult}` :
                    `${fieldType} captured: ${processedResult}`;

                const confirmUtterance = new SpeechSynthesisUtterance(confirmText);
                confirmUtterance.lang = fieldType === 'email' ? 'en-IN' :
                                       currentLang === 'hi' ? 'hi-IN' :
                                       currentLang === 'gu' ? 'gu-IN' : 'en-IN';
                confirmUtterance.rate = 0.9;
                speechSynthesis.speak(confirmUtterance);
            };

            recognition.onerror = function(event) {
                showToast('Voice input failed. Please try again.', 'error');
                console.error('Speech recognition error:', event.error);
            };

            recognition.onend = function() {
                // Reset button
                voiceBtn.style.background = '#28a745';
                voiceBtn.innerHTML = 'üé§';
                voiceBtn.disabled = false;
            };
        }

        function toggleVoiceListening() {
            const voiceBtn = document.getElementById('voiceListenBtn');

            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showToast('Speech recognition not supported', 'error');
                return;
            }

            if (isVoiceListening) {
                if (window.currentRecognition) {
                    window.currentRecognition.stop();
                }
                voiceBtn.classList.remove('listening', 'active');
                isVoiceListening = false;
                showToast('Voice listening stopped', 'info');
            } else {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();

                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = getLanguageCode(currentLanguage);

                recognition.onstart = function() {
                    voiceBtn.classList.add('listening', 'active');
                    isVoiceListening = true;
                    showToast('Listening... Speak now!', 'success');
                };

                recognition.onresult = function(event) {
                    const result = event.results[0][0].transcript;
                    handleVoiceCommand(result);
                };

                recognition.onerror = function(event) {
                    voiceBtn.classList.remove('listening', 'active');
                    isVoiceListening = false;
                    showToast('Voice recognition error. Try again.', 'error');
                };

                recognition.onend = function() {
                    voiceBtn.classList.remove('listening', 'active');
                    isVoiceListening = false;
                };

                window.currentRecognition = recognition;
                recognition.start();
            }
        }

        function getLanguageCode(lang) {
            const codes = {
                'en': 'en-IN', 'hi': 'hi-IN', 'bn': 'bn-IN', 'te': 'te-IN',
                'mr': 'mr-IN', 'ta': 'ta-IN', 'gu': 'gu-IN', 'ur': 'ur-PK',
                'kn': 'kn-IN', 'ml': 'ml-IN', 'or': 'or-IN', 'pa': 'pa-IN'
            };
            return codes[lang] || 'en-IN';
        }

        function handleVoiceCommand(spokenText) {
            console.log('Voice command:', spokenText);

            // Check if user is trying to fill a form field
            const activeElement = document.activeElement;
            if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {
                fillFormFieldWithVoice(activeElement, spokenText);
                return;
            }

            // Handle navigation commands
            const command = spokenText.toLowerCase();
            if (command.includes('farmer') || command.includes('‡§ï‡§ø‡§∏‡§æ‡§®')) {
                selectUserByType('farmer');
            } else if (command.includes('middleman') || command.includes('‡§¨‡§ø‡§ö‡•å‡§≤‡§ø‡§Ø‡§æ')) {
                selectUserByType('middleman');
            } else if (command.includes('agent') || command.includes('‡§è‡§ú‡•á‡§Ç‡§ü')) {
                selectUserByType('field_agent');
            } else {
                speakInCurrentLanguage('Command not recognized. Click on a form field and speak to fill it, or say a user type name.', '‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§∏‡§Æ‡§ù ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§Ü‡§Ø‡§æ‡•§ ‡§´‡•â‡§∞‡•ç‡§Æ ‡§´‡•Ä‡§≤‡•ç‡§° ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§');
            }
        }

        function selectUserByType(userType) {
            const userCards = document.querySelectorAll('.user-card');
            userCards.forEach((card, index) => {
                if ((userType === 'farmer' && index === 0) ||
                    (userType === 'middleman' && index === 1) ||
                    (userType === 'field_agent' && index === 2)) {
                    card.click();
                }
            });
        }

        function fillFormFieldWithVoice(field, spokenText) {
            let cleanText = spokenText.trim();

            if (field.type === 'email') {
                cleanText = cleanText.replace(/\s+at\s+/gi, '@')
                                   .replace(/\s+dot\s+/gi, '.')
                                   .replace(/\s/g, '');
            } else if (field.type === 'tel') {
                cleanText = cleanText.replace(/\D/g, '');
            } else if (field.type === 'number') {
                const numbers = cleanText.match(/\d+/g);
                cleanText = numbers ? numbers.join('') : '';
            }

            field.value = cleanText;
            field.dispatchEvent(new Event('input', { bubbles: true }));

            const fieldLabel = field.previousElementSibling?.textContent || field.placeholder;
            showToast(`Filled: ${cleanText}`, 'success');
            speakInCurrentLanguage(`Filled ${fieldLabel} with ${cleanText}`, `${fieldLabel} ‡§Æ‡•á‡§Ç ${cleanText} ‡§≠‡§∞‡§æ ‡§ó‡§Ø‡§æ`);
        }

        function speakPageContent() {
            if (!('speechSynthesis' in window)) {
                showToast('Speech synthesis not supported', 'error');
                return;
            }

            const welcomeMessages = {
                'en': 'Welcome to FarmTrace complete prototype. This application works in 24 Indian languages with full voice support for illiterate farmers. Click any user type to see their dashboard.',
                'hi': '‡§´‡§æ‡§∞‡•ç‡§Æ‡§ü‡•ç‡§∞‡•á‡§∏ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§™‡•ç‡§∞‡•ã‡§ü‡•ã‡§ü‡§æ‡§á‡§™ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§®‡§ø‡§∞‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Ü‡§µ‡§æ‡§ú ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡•á ‡§∏‡§æ‡§• 24 ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡•§ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§',
                'as': '‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡¶ü‡ßç‡ß∞‡ßá‡¶ö‡ß∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡ß∞‡ßç‡¶£ ‡¶™‡ßç‡ß∞‡¶ü‡ßã‡¶ü‡¶æ‡¶á‡¶™‡¶≤‡ßà ‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡¶ï ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ‡•§ ‡¶è‡¶á ‡¶è‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡ßç‡¶Ø‡¶®‡¶ü‡ßã ‡¶®‡¶ø‡ß∞‡¶ï‡ßç‡¶∑‡ß∞ ‡¶ï‡ßÉ‡¶∑‡¶ï‡ß∞ ‡¶¨‡¶æ‡¶¨‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡ß∞‡ßç‡¶£ ‡¶ï‡¶£‡ßç‡¶†‡¶∏‡ßç‡¶¨‡ß∞ ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶§‡¶æ‡ß∞ ‡¶∏‡ßà‡¶§‡ßá ‡ß®‡ßÑ ‡¶ñ‡¶® ‡¶≠‡¶æ‡ß∞‡¶§‡ßÄ‡¶Ø‡¶º ‡¶≠‡¶æ‡¶∑‡¶æ‡¶§ ‡¶ï‡¶æ‡¶Æ ‡¶ï‡ß∞‡ßá‡•§',
                'bn': '‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡¶ü‡ßç‡¶∞‡ßá‡¶∏ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶™‡ßç‡¶∞‡ßã‡¶ü‡ßã‡¶ü‡¶æ‡¶á‡¶™‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ‡•§ ‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡¶®‡¶ü‡¶ø ‡¶®‡¶ø‡¶∞‡¶ï‡ßç‡¶∑‡¶∞ ‡¶ï‡ßÉ‡¶∑‡¶ï‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶π ‡ß®‡ß™‡¶ü‡¶ø ‡¶≠‡¶æ‡¶∞‡¶§‡ßÄ‡¶Ø‡¶º ‡¶≠‡¶æ‡¶∑‡¶æ‡¶Ø‡¶º ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá‡•§',
                'gu': '‡™´‡™æ‡™∞‡´ç‡™Æ‡™ü‡´ç‡™∞‡´á‡™∏ ‡™∏‡™Ç‡™™‡´Ç‡™∞‡´ç‡™£ ‡™™‡´ç‡™∞‡´ã‡™ü‡´ã‡™ü‡™æ‡™á‡™™‡™Æ‡™æ‡™Ç ‡™Ü‡™™‡™®‡´Å‡™Ç ‡™∏‡´ç‡™µ‡™æ‡™ó‡™§ ‡™õ‡´á. ‡™Ü ‡™è‡™™‡´ç‡™≤‡™ø‡™ï‡´á‡™∂‡™® ‡´®‡´™ ‡™≠‡™æ‡™∞‡™§‡´Ä‡™Ø ‡™≠‡™æ‡™∑‡™æ‡™ì‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∞‡™ï‡´ç‡™∑‡™∞ ‡™ñ‡´á‡™°‡´Ç‡™§‡´ã ‡™Æ‡™æ‡™ü‡´á ‡™∏‡™Ç‡™™‡´Ç‡™∞‡´ç‡™£ ‡™µ‡´â‡™á‡™∏ ‡™∏‡™™‡´ã‡™∞‡´ç‡™ü ‡™∏‡™æ‡™•‡´á ‡™ï‡™æ‡™Æ ‡™ï‡™∞‡´á ‡™õ‡´á.',
                'kn': '‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç‚Äå‡≤ü‡≥ç‡≤∞‡≥á‡≤∏‡≥ç ‡≤∏‡≤Ç‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ ‡≤™‡≥ç‡≤∞‡≥ã‡≤ü‡≥ã‡≤ü‡≥à‡≤™‡≥ç‚Äå‡≤ó‡≥Ü ‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤∏‡≥ç‡≤µ‡≤æ‡≤ó‡≤§. ‡≤à ‡≤Ö‡≤™‡≥ç‡≤≤‡≤ø‡≤ï‡≥á‡≤∂‡≤®‡≥ç ‡≤Ö‡≤®‡≤ï‡≥ç‡≤∑‡≤∞‡≤∏‡≥ç‡≤• ‡≤∞‡≥à‡≤§‡≤∞‡≤ø‡≤ó‡≤æ‡≤ó‡≤ø ‡≤∏‡≤Ç‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ ‡≤ß‡≥ç‡≤µ‡≤®‡≤ø ‡≤¨‡≥Ü‡≤Ç‡≤¨‡≤≤‡≤¶‡≥ä‡≤Ç‡≤¶‡≤ø‡≤ó‡≥Ü ‡≥®‡≥™ ‡≤≠‡≤æ‡≤∞‡≤§‡≥Ä‡≤Ø ‡≤≠‡≤æ‡≤∑‡≥Ü‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤ï‡≤æ‡≤∞‡≥ç‡≤Ø‡≤®‡≤ø‡≤∞‡≥ç‡≤µ‡≤π‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü.',
                'ml': '‡¥´‡¥æ‡¥Ç ‡¥ü‡µç‡¥∞‡µá‡¥∏‡µç ‡¥∏‡¥Æ‡µç‡¥™‡µÇ‡µº‡¥£‡µç‡¥£ ‡¥™‡µç‡¥∞‡µã‡¥ü‡µç‡¥ü‡µã‡¥ü‡µà‡¥™‡µç‡¥™‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç. ‡¥à ‡¥Ü‡¥™‡µç‡¥≤‡¥ø‡¥ï‡µç‡¥ï‡µá‡¥∑‡µª ‡¥®‡¥ø‡¥∞‡¥ï‡µç‡¥∑‡¥∞‡¥Ø‡¥æ‡¥Ø ‡¥ï‡µº‡¥∑‡¥ï‡µº‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø ‡¥∏‡¥Æ‡µç‡¥™‡µÇ‡µº‡¥£‡µç‡¥£ ‡¥µ‡µã‡¥Ø‡µç‡¥∏‡µç ‡¥™‡¥ø‡¥®‡µç‡¥§‡µÅ‡¥£‡¥Ø‡µã‡¥ü‡µÜ ‡µ®‡µ™ ‡¥á‡¥®‡µç‡¥°‡µç‡¥Ø‡µª ‡¥≠‡¥æ‡¥∑‡¥ï‡¥≥‡¥ø‡µΩ ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ.',
                'mr': '‡§´‡§æ‡§∞‡•ç‡§Æ‡§ü‡•ç‡§∞‡•á‡§∏ ‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§™‡•ç‡§∞‡•ã‡§ü‡•ã‡§ü‡§æ‡§á‡§™‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§§‡•Å‡§Æ‡§ö‡•á ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á. ‡§π‡•á ‡§ç‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§®‡§ø‡§∞‡§ï‡•ç‡§∑‡§∞ ‡§∂‡•á‡§§‡§ï‡§±‡•ç‡§Ø‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä ‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Ü‡§µ‡§æ‡§ú ‡§∏‡§Æ‡§∞‡•ç‡§•‡§®‡§æ‡§∏‡§π ‡•®‡•™ ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§≠‡§æ‡§∑‡§æ‡§Ç‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§∞‡§§‡•á.',
                'or': '‡¨´‡¨æ‡¨∞‡≠ç‡¨Æ‡¨ü‡≠ç‡¨∞‡≠á‡¨∏‡≠ç ‡¨∏‡¨Æ‡≠ç‡¨™‡≠Ç‡¨∞‡≠ç‡¨£‡≠ç‡¨£ ‡¨™‡≠ç‡¨∞‡≠ã‡¨ü‡≠ã‡¨ü‡¨æ‡¨á‡¨™‡¨ï‡≠Å ‡¨∏‡≠ç‡≠±‡¨æ‡¨ó‡¨§‡•§ ‡¨è‡¨π‡¨ø ‡¨Ü‡¨™‡≠ç‡¨≤‡¨ø‡¨ï‡≠á‡¨∂‡¨®‡≠ç ‡¨®‡¨ø‡¨∞‡¨ï‡≠ç‡¨∑‡¨∞ ‡¨ï‡≠É‡¨∑‡¨ï‡¨ô‡≠ç‡¨ï ‡¨™‡¨æ‡¨á‡¨Å ‡¨∏‡¨Æ‡≠ç‡¨™‡≠Ç‡¨∞‡≠ç‡¨£‡≠ç‡¨£ ‡¨∏‡≠ç‡≠±‡¨∞ ‡¨∏‡¨π‡¨æ‡≠ü‡¨§‡¨æ ‡¨∏‡¨π‡¨ø‡¨§ ‡≠®‡≠™‡¨ü‡¨ø ‡¨≠‡¨æ‡¨∞‡¨§‡≠Ä‡≠ü ‡¨≠‡¨æ‡¨∑‡¨æ‡¨∞‡≠á ‡¨ï‡¨æ‡¨Æ ‡¨ï‡¨∞‡≠á‡•§',
                'pa': '‡®´‡®æ‡®∞‡®Æ‡®ü‡©ç‡®∞‡©á‡®∏ ‡®∏‡©∞‡®™‡©Ç‡®∞‡®® ‡®™‡©ç‡®∞‡©ã‡®ü‡©ã‡®ü‡®æ‡®à‡®™ ‡®µ‡®ø‡©±‡®ö ‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®∏‡©Å‡®Ü‡®ó‡®§ ‡®π‡©à‡•§ ‡®á‡®π ‡®ê‡®™‡®≤‡©Ä‡®ï‡©á‡®∏‡®º‡®® ‡®Ö‡®®‡®™‡©ú‡©ç‡®π ‡®ï‡®ø‡®∏‡®æ‡®®‡®æ‡®Ç ‡®≤‡®à ‡®™‡©Ç‡®∞‡®® ‡®Ü‡®µ‡®æ‡®ú‡®º ‡®∏‡®π‡®ø‡®Ø‡©ã‡®ó ‡®®‡®æ‡®≤ ‡©®‡©™ ‡®≠‡®æ‡®∞‡®§‡©Ä ‡®≠‡®æ‡®∏‡®º‡®æ‡®µ‡®æ‡®Ç ‡®µ‡®ø‡©±‡®ö ‡®ï‡©∞‡®Æ ‡®ï‡®∞‡®¶‡©Ä ‡®π‡©à‡•§',
                'ta': '‡Æ™‡Ææ‡Æ∞‡Øç‡ÆÆ‡Øç‡Æü‡Øç‡Æ∞‡Øá‡Æ∏‡Øç ‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ© ‡ÆÆ‡ØÅ‡Æ©‡Øç‡ÆÆ‡Ææ‡Æ§‡Æø‡Æ∞‡Æø‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç. ‡Æá‡Æ®‡Øç‡Æ§ ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æø ‡Æï‡Æ≤‡Øç‡Æµ‡Æø‡ÆØ‡Æ±‡Æø‡Æµ‡Æ±‡Øç‡Æ± ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æï ‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ© ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡ÆÜ‡Æ§‡Æ∞‡Æµ‡ØÅ‡Æü‡Æ©‡Øç ‡Ø®‡Ø™ ‡Æá‡Æ®‡Øç‡Æ§‡Æø‡ÆØ ‡ÆÆ‡Øä‡Æ¥‡Æø‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ‡•§',
                'te': '‡∞´‡∞æ‡∞Æ‡±ç‚Äå‡∞ü‡±ç‡∞∞‡±á‡∞∏‡±ç ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞®‡∞Æ‡±Ç‡∞®‡∞æ‡∞ï‡±Å ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç. ‡∞à ‡∞Ö‡∞™‡±ç‡∞≤‡∞ø‡∞ï‡±á‡∞∑‡∞®‡±ç ‡∞®‡∞ø‡∞∞‡∞ï‡±ç‡∞∑‡∞∞‡∞æ‡∞∏‡±ç‡∞Ø‡∞§ ‡∞∞‡±à‡∞§‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞Æ‡∞¶‡±ç‡∞¶‡∞§‡±Å‡∞§‡±ã ‡±®‡±™ ‡∞≠‡∞æ‡∞∞‡∞§‡±Ä‡∞Ø ‡∞≠‡∞æ‡∞∑‡∞≤‡±ç‡∞≤‡±ã ‡∞™‡∞®‡∞ø‡∞ö‡±á‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø‡•§',
                'ur': 'ŸÅÿßÿ±ŸÖ Ÿπÿ±€åÿ≥ ŸÖ⁄©ŸÖŸÑ Ÿæÿ±ŸàŸπŸà Ÿπÿßÿ¶Ÿæ ŸÖ€å⁄∫ ÿ¢Ÿæ ⁄©ÿß ÿÆŸàÿ¥ ÿ¢ŸÖÿØ€åÿØ€î €å€Å ÿß€åŸæŸÑ€å ⁄©€åÿ¥ŸÜ ÿßŸÜ Ÿæ⁄ë⁄æ ⁄©ÿ≥ÿßŸÜŸà⁄∫ ⁄©€í ŸÑ€å€í ŸÖ⁄©ŸÖŸÑ ÿ¢Ÿàÿßÿ≤ ⁄©€å ŸÖÿØÿØ ⁄©€í ÿ≥ÿßÿ™⁄æ €≤€¥ €ÅŸÜÿØŸàÿ≥ÿ™ÿßŸÜ€å ÿ≤ÿ®ÿßŸÜŸà⁄∫ ŸÖ€å⁄∫ ⁄©ÿßŸÖ ⁄©ÿ±ÿ™€å €Å€í€î'
            };

            const translations = {
                'en': {
                    'name_label': 'Full Name',
                    'phone_label': 'Phone Number',
                    'email_label': 'Email',
                    'location_label': 'Farm Location',
                    'size_label': 'Farm Size in Acres',
                    'name_placeholder': 'Enter your full name',
                    'phone_placeholder': 'Enter your phone number',
                    'email_placeholder': 'Enter your email address',
                    'location_placeholder': 'Enter your farm location',
                    'size_placeholder': 'Enter farm size in acres',
                    'farmer_desc': 'Crop management, KYC upload, marketplace',
                    'middleman_desc': 'Trade aggregation, price setting, logistics'
                },
                'hi': {
                    'name_label': '‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ',
                    'phone_label': '‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞',
                    'email_label': '‡§à‡§Æ‡•á‡§≤',
                    'location_label': '‡§ñ‡•á‡§§ ‡§ï‡§æ ‡§∏‡•ç‡§•‡§æ‡§®',
                    'size_label': '‡§è‡§ï‡§°‡§º ‡§Æ‡•á‡§Ç ‡§ñ‡•á‡§§ ‡§ï‡§æ ‡§Ü‡§ï‡§æ‡§∞',
                    'name_placeholder': '‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                    'phone_placeholder': '‡§Ö‡§™‡§®‡§æ ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                    'email_placeholder': '‡§Ö‡§™‡§®‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                    'location_placeholder': '‡§Ö‡§™‡§®‡•á ‡§ñ‡•á‡§§ ‡§ï‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                    'size_placeholder': '‡§è‡§ï‡§°‡§º ‡§Æ‡•á‡§Ç ‡§ñ‡•á‡§§ ‡§ï‡§æ ‡§Ü‡§ï‡§æ‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                    'farmer_desc': '‡§´‡§∏‡§≤ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®, ‡§ï‡•á‡§µ‡§æ‡§à‡§∏‡•Ä ‡§Ö‡§™‡§≤‡•ã‡§°, ‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü‡§™‡•ç‡§≤‡•á‡§∏',
                    'middleman_desc': '‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞ ‡§è‡§ï‡§§‡•ç‡§∞‡•Ä‡§ï‡§∞‡§£, ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§£, ‡§∞‡§∏‡§¶'
                },
                'gu': {
                    'name_label': '‡™™‡´Ç‡™∞‡´Å‡™Ç ‡™®‡™æ‡™Æ',
                    'phone_label': '‡™´‡´ã‡™® ‡™®‡™Ç‡™¨‡™∞',
                    'email_label': '‡™à‡™Æ‡´á‡™à‡™≤',
                    'location_label': '‡™ñ‡´á‡™§‡™∞‡™®‡´Ä ‡™ú‡™ó‡´ç‡™Ø‡™æ',
                    'size_label': '‡™è‡™ï‡™∞‡™Æ‡™æ‡™Ç ‡™ñ‡´á‡™§‡™∞‡™®‡´Å‡™Ç ‡™ï‡™¶',
                    'name_placeholder': '‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™™‡´Ç‡™∞‡´Å‡™Ç ‡™®‡™æ‡™Æ ‡™¶‡™æ‡™ñ‡™≤ ‡™ï‡™∞‡´ã',
                    'phone_placeholder': '‡™§‡™Æ‡™æ‡™∞‡´ã ‡™´‡´ã‡™® ‡™®‡™Ç‡™¨‡™∞ ‡™¶‡™æ‡™ñ‡™≤ ‡™ï‡™∞‡´ã',
                    'email_placeholder': '‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™à‡™Æ‡´á‡™à‡™≤ ‡™∏‡™∞‡™®‡™æ‡™Æ‡´Å‡™Ç ‡™¶‡™æ‡™ñ‡™≤ ‡™ï‡™∞‡´ã',
                    'location_placeholder': '‡™§‡™Æ‡™æ‡™∞‡™æ ‡™ñ‡´á‡™§‡™∞‡™®‡´Å‡™Ç ‡™∏‡´ç‡™•‡™æ‡™® ‡™¶‡™æ‡™ñ‡™≤ ‡™ï‡™∞‡´ã',
                    'size_placeholder': '‡™è‡™ï‡™∞‡™Æ‡™æ‡™Ç ‡™ñ‡´á‡™§‡™∞‡™®‡´Å‡™Ç ‡™ï‡™¶ ‡™¶‡™æ‡™ñ‡™≤ ‡™ï‡™∞‡´ã',
                    'farmer_desc': '‡™™‡™æ‡™ï ‡™µ‡´ç‡™Ø‡™µ‡™∏‡´ç‡™•‡™æ‡™™‡™®, ‡™ï‡´á‡™µ‡™æ‡™Ø‡™∏‡´Ä ‡™Ö‡™™‡™≤‡´ã‡™°, ‡™Æ‡™æ‡™∞‡´ç‡™ï‡´á‡™ü‡™™‡´ç‡™≤‡´á‡™∏',
                    'middleman_desc': '‡™µ‡´á‡™™‡™æ‡™∞ ‡™è‡™ï‡´Ä‡™ï‡™∞‡™£, ‡™≠‡™æ‡™µ ‡™®‡™ø‡™∞‡´ç‡™ß‡™æ‡™∞‡™£, ‡™≤‡´ã‡™ú‡™ø‡™∏‡´ç‡™ü‡™ø‡™ï‡´ç‡™∏'
                }
            };

            const textToSpeak = welcomeMessages[currentLanguage] || welcomeMessages['en'];

            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = getLanguageCode(currentLanguage);
            utterance.rate = 0.8;

            speechSynthesis.cancel();
            speechSynthesis.speak(utterance);

            showToast('Reading page content...', 'info');
        }

        function speakVoiceHelp() {
            const helpMessages = {
                'en': 'Welcome to FarmTrace voice help. This app works in 24 languages. To use: First, select your language. Second, click any form field and speak to fill it. Third, use voice commands like farmer, middleman to switch user types. Click the microphone and speak your commands.',
                'hi': '‡§´‡§æ‡§∞‡•ç‡§Æ‡§ü‡•ç‡§∞‡•á‡§∏ ‡§µ‡•â‡§á‡§∏ ‡§π‡•á‡§≤‡•ç‡§™ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§ê‡§™ 24 ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è: ‡§™‡§π‡§≤‡•á, ‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç‡•§ ‡§¶‡•Ç‡§∏‡§∞‡•á, ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ ‡§´‡•Ä‡§≤‡•ç‡§° ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§≠‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§ ‡§§‡•Ä‡§∏‡§∞‡•á, ‡§ï‡§ø‡§∏‡§æ‡§®, ‡§¨‡§ø‡§ö‡•å‡§≤‡§ø‡§Ø‡§æ ‡§ú‡•à‡§∏‡•á ‡§µ‡•â‡§á‡§∏ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§'
            };

            const helpText = helpMessages[currentLanguage] || helpMessages['en'];

            const utterance = new SpeechSynthesisUtterance(helpText);
            utterance.lang = getLanguageCode(currentLanguage);
            utterance.rate = 0.7;

            speechSynthesis.cancel();
            speechSynthesis.speak(utterance);

            showToast('Playing voice help...', 'info');
        }

        function speakInCurrentLanguage(englishText, hindiText) {
            const textToSpeak = currentLanguage === 'hi' ? hindiText : englishText;
            if (speechSynthesis) {
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                utterance.lang = getLanguageCode(currentLanguage);
                speechSynthesis.speak(utterance);
            }
        }

        function speakWelcomeMessage() {
            setTimeout(() => {
                speakInCurrentLanguage(
                    'Welcome to FarmTrace. Select a user type to see their dashboard. Voice features work in all 24 languages.',
                    '‡§´‡§æ‡§∞‡•ç‡§Æ‡§ü‡•ç‡§∞‡•á‡§∏ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à‡•§ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç‡•§ ‡§µ‡•â‡§á‡§∏ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Ç ‡§∏‡§≠‡•Ä 24 ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡§Ç‡•§'
                );
            }, 1000);
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ========== ENHANCED MODAL MANAGEMENT ==========

        function closeAllModals() {
            const modals = document.querySelectorAll('[data-modal="true"]');
            modals.forEach(modal => {
                if (modal.parentNode) {
                    modal.parentNode.removeChild(modal);
                }
            });
        }

        function createModal(content, modalId = null) {
            closeAllModals(); // Close any existing modals first

            const modal = document.createElement('div');
            modal.setAttribute('data-modal', 'true');
            if (modalId) modal.id = modalId;

            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="event.target === this && closeModal('${modalId || 'default'}')">
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 90vw; max-height: 90vh; overflow-y: auto;" onclick="event.stopPropagation();">
                        ${content}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            return modal;
        }

        function closeModal(modalId = null) {
            if (modalId && modalId !== 'default') {
                const modal = document.getElementById(modalId);
                if (modal && modal.parentNode) {
                    modal.parentNode.removeChild(modal);
                }
            } else {
                closeAllModals();
            }
        }

        function showActionModal(action) {
            const content = `
                <div style="text-align: center; max-width: 500px;">
                    <h3 style="margin-bottom: 20px; color: #2d5a27;">‚úÖ ${action}</h3>
                    <div style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <p style="color: #666; margin-bottom: 15px;">This action has been successfully executed in demo mode.</p>
                        <p style="color: #28a745; font-weight: bold;">Status: ‚úÖ Completed</p>
                        <p style="color: #666; font-size: 14px; margin-top: 10px;">Timestamp: ${new Date().toLocaleString()}</p>
                    </div>
                    <button onclick="closeModal()" style="background: #28a745; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 16px;">‚úì Close</button>
                </div>
            `;

            createModal(content, 'action-modal');
            showToast(`${action} completed successfully!`, 'success');
        }

        // Farmer specific functions
        function showMarketplace() {
            const content = `
                <h3 style="margin-bottom: 20px; color: #2d5a27;">üõí Agricultural Marketplace</h3>
                <div style="margin: 20px 0;">
                    <h4>üåæ Available Buyers in Your Area:</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <strong>Metro Fresh Mart</strong> - Rice: ‚Çπ2,850/quintal | Min: 500kg<br>
                        <small>üìç Distance: 5km | Rating: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</small>
                        <button style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px;" onclick="contactBuyer('Metro Fresh Mart')">üìû Contact</button>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <strong>Organic Store</strong> - Tomatoes: ‚Çπ3,200/quintal | Min: 200kg<br>
                        <small>üìç Distance: 8km | Rating: ‚≠ê‚≠ê‚≠ê‚≠ê</small>
                        <button style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px;" onclick="contactBuyer('Organic Store')">üìû Contact</button>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <strong>Village Mandi</strong> - Mixed Vegetables: ‚Çπ2,500/quintal<br>
                        <small>üìç Distance: 3km | Rating: ‚≠ê‚≠ê‚≠ê</small>
                        <button style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px;" onclick="contactBuyer('Village Mandi')">üìû Contact</button>
                    </div>
                </div>
                <button onclick="closeModal('marketplace')" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 15px;">Close</button>
            `;

            createModal(content, 'marketplace');
            showToast('Marketplace loaded with 3 active buyers!', 'success');
            speakInCurrentLanguage('Marketplace shows 3 buyers interested in your crops', '‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü‡§™‡•ç‡§≤‡•á‡§∏ ‡§Æ‡•á‡§Ç 3 ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞ ‡§Ü‡§™‡§ï‡•Ä ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∞‡•Å‡§ö‡§ø ‡§∞‡§ñ‡§§‡•á ‡§π‡•à‡§Ç');
        }

        function contactBuyer(buyerName) {
            showToast(`Contacting ${buyerName}...`, 'info');
            speakInCurrentLanguage(`Contacting ${buyerName}`, `${buyerName} ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç`);
            setTimeout(() => {
                showToast(`Successfully contacted ${buyerName}!`, 'success');
                closeModal('marketplace');
            }, 1500);
        }

        function checkSoilMoisture() {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 500px;">
                        <h3 style="margin-bottom: 20px; color: #2d5a27;">üíß Soil Moisture Analysis</h3>
                        <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin: 15px 0;">
                            <h4 style="color: #2d5a27;">Current Status: OPTIMAL ‚úÖ</h4>
                            <p><strong>Moisture Level:</strong> 68% (Ideal: 60-75%)</p>
                            <p><strong>Last Reading:</strong> ${new Date().toLocaleTimeString()}</p>
                            <p><strong>Next Irrigation:</strong> In 2 days</p>
                            <p><strong>Weather Forecast:</strong> No rain expected</p>
                        </div>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <strong>üí° Recommendation:</strong> Soil moisture is optimal. Continue current irrigation schedule.
                        </div>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            showToast('Soil moisture: 68% - Optimal level!', 'success');
            speakInCurrentLanguage('Soil moisture is at optimal level of 68 percent', '‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§®‡§Æ‡•Ä 68 ‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤ ‡§∏‡•ç‡§§‡§∞ ‡§™‡§∞ ‡§π‡•à');
        }

        // Middleman specific functions
        function showFarmerMarketplace() {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 700px; width: 95%;">
                        <h3 style="margin-bottom: 20px; color: #2d5a27;">üë®‚Äçüåæ Available Farmers & Crops</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px;">
                                <h4>Rajesh Kumar - Rice Producer</h4>
                                <p><strong>Available:</strong> 750kg Premium Rice</p>
                                <p><strong>Price:</strong> ‚Çπ2,800/quintal</p>
                                <p><strong>Quality:</strong> Grade A+ ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</p>
                                <p><strong>Location:</strong> 5km away</p>
                                <button style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px; width: 100%; margin-top: 10px;">üõí Purchase</button>
                            </div>
                            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px;">
                                <h4>Sunita Devi - Vegetable Farm</h4>
                                <p><strong>Available:</strong> 500kg Mixed Vegetables</p>
                                <p><strong>Price:</strong> ‚Çπ3,100/quintal</p>
                                <p><strong>Quality:</strong> Grade A ‚≠ê‚≠ê‚≠ê‚≠ê</p>
                                <p><strong>Location:</strong> 3km away</p>
                                <button style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px; width: 100%; margin-top: 10px;">üõí Purchase</button>
                            </div>
                        </div>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 20px;">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            showToast('Found 2 farmers with available crops!', 'success');
            speakInCurrentLanguage('Found 2 farmers with crops ready for purchase', '2 ‡§ï‡§ø‡§∏‡§æ‡§® ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§´‡§∏‡§≤ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Æ‡§ø‡§≤‡•á');
        }

        function setMarketPrices() {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                        <h3 style="margin-bottom: 20px; color: #2d5a27;">üí∞ Set Market Prices</h3>
                        <div style="margin: 20px 0;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Rice (per quintal):</label>
                                <input type="number" value="2850" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Wheat (per quintal):</label>
                                <input type="number" value="2950" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Vegetables (per quintal):</label>
                                <input type="number" value="3200" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <button onclick="this.closest('div').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin-right: 10px;">Cancel</button>
                            <button onclick="updatePrices(); this.closest('div').parentElement.remove();" style="background: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">Update Prices</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            showToast('Price setting panel opened', 'info');
            speakInCurrentLanguage('Market price setting panel is now open', '‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§£ ‡§™‡•à‡§®‡§≤ ‡§Ö‡§¨ ‡§ñ‡•Å‡§≤‡§æ ‡§π‡•à');
        }

        function updatePrices() {
            showToast('Market prices updated successfully!', 'success');
            speakInCurrentLanguage('Market prices have been updated', '‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡§Ç');
        }

        function showPriceTrends() {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 95%;">
                        <h3 style="margin-bottom: 20px; color: #2d5a27;">üìä Price Trend Analysis</h3>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0;">
                            <h4>üåæ Rice Prices (Last 7 days)</h4>
                            <p>üìà Trend: <span style="color: #28a745;">+8.5% ‚ÜóÔ∏è</span></p>
                            <p>Current: ‚Çπ2,850/quintal | Peak: ‚Çπ2,900 | Low: ‚Çπ2,630</p>
                            <p><strong>Prediction:</strong> Prices likely to increase by 3-5% next week</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0;">
                            <h4>ü•ï Vegetable Prices (Last 7 days)</h4>
                            <p>üìâ Trend: <span style="color: #dc3545;">-4.2% ‚ÜòÔ∏è</span></p>
                            <p>Current: ‚Çπ3,200/quintal | Peak: ‚Çπ3,450 | Low: ‚Çπ3,180</p>
                            <p><strong>Prediction:</strong> Prices may stabilize at current levels</p>
                        </div>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            showToast('Price trends analyzed for last 7 days', 'success');
            speakInCurrentLanguage('Price trend analysis shows rice prices increasing', '‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§™‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ö‡§æ‡§µ‡§≤ ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø ‡§¶‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à');
        }

        function findRetailers() {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 95%;">
                        <h3 style="margin-bottom: 20px; color: #2d5a27;">üè™ Retailers in Your Network</h3>
                        <div style="margin: 20px 0;">
                            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                <h4>Fresh Mart Supermarket</h4>
                                <p><strong>Requirements:</strong> 200kg Rice, 150kg Vegetables weekly</p>
                                <p><strong>Payment Terms:</strong> 15 days | Rating: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</p>
                                <p><strong>Contact:</strong> +91-98765-12345</p>
                                <button style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px;">üìû Contact</button>
                            </div>
                            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                <h4>Organic Valley Store</h4>
                                <p><strong>Requirements:</strong> 100kg Organic Produce monthly</p>
                                <p><strong>Payment Terms:</strong> 7 days | Rating: ‚≠ê‚≠ê‚≠ê‚≠ê</p>
                                <p><strong>Contact:</strong> +91-98765-67890</p>
                                <button style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px;">üìû Contact</button>
                            </div>
                        </div>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            showToast('Found 2 active retailers looking for suppliers', 'success');
            speakInCurrentLanguage('Found 2 retailers seeking fresh produce suppliers', '2 ‡§ñ‡•Å‡§¶‡§∞‡§æ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ ‡§§‡§æ‡§ú‡§æ ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•Ä ‡§§‡§≤‡§æ‡§∂ ‡§Æ‡•á‡§Ç ‡§Æ‡§ø‡§≤‡•á');
        }

        // Field Agent functions
        function reviewKYCDocuments() {
            showActionModal('üìë Review KYC Documents');
            speakInCurrentLanguage('KYC document review panel opened', '‡§ï‡•á‡§µ‡§æ‡§à‡§∏‡•Ä ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§™‡•à‡§®‡§≤ ‡§ñ‡•Å‡§≤‡§æ');
        }

        function scheduleFarmVisit() {
            showActionModal('üåæ Schedule Farm Visit');
            speakInCurrentLanguage('Farm visit scheduled successfully', '‡§ñ‡•á‡§§ ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§');
        }

        function approveApplications() {
            showActionModal('‚úì Approve Applications');
            speakInCurrentLanguage('Applications approved successfully', '‡§Ü‡§µ‡•á‡§¶‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§®‡•Å‡§Æ‡•ã‡§¶‡§ø‡§§');
        }

        function generateReports() {
            showActionModal('üìä Generate Reports');
            speakInCurrentLanguage('Reports generated successfully', '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à');
        }

        // Transporter functions
        function trackVehicles() {
            showActionModal('üìç Track Live Vehicles');
            speakInCurrentLanguage('Vehicle tracking system opened', '‡§µ‡§æ‡§π‡§® ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ñ‡•Å‡§≤‡§æ');
        }

        function optimizeRoutes() {
            showActionModal('üó∫Ô∏è Optimize Routes');
            speakInCurrentLanguage('Route optimization completed', '‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§® ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü');
        }

        function contactDrivers() {
            showActionModal('üìû Contact Drivers');
            speakInCurrentLanguage('Driver contact system opened', '‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ñ‡•Å‡§≤‡§æ');
        }

        function manageFuelCosts() {
            showActionModal('‚õΩ Manage Fuel Costs');
            speakInCurrentLanguage('Fuel cost management panel opened', '‡§à‡§Ç‡§ß‡§® ‡§≤‡§æ‡§ó‡§§ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§™‡•à‡§®‡§≤ ‡§ñ‡•Å‡§≤‡§æ');
        }

        // Consumer functions
        function scanProductQR() {
            showActionModal('üì± Scan Product QR');
            speakInCurrentLanguage('QR scanner opened for product verification', '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§® ‡§ï‡•á ‡§≤‡§ø‡§è QR ‡§∏‡•ç‡§ï‡•à‡§®‡§∞ ‡§ñ‡•Å‡§≤‡§æ');
        }

        function showProductHistory() {
            showActionModal('üìú Product History');
            speakInCurrentLanguage('Product history and traceability displayed', '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§î‡§∞ ‡§ü‡•ç‡§∞‡•á‡§∏‡•á‡§¨‡§ø‡§≤‡§ø‡§ü‡•Ä ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§ó‡§à');
        }

        function rateAndReview() {
            showActionModal('‚≠ê Rate & Review');
            speakInCurrentLanguage('Rating and review panel opened', '‡§∞‡•á‡§ü‡§ø‡§Ç‡§ó ‡§î‡§∞ ‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§™‡•à‡§®‡§≤ ‡§ñ‡•Å‡§≤‡§æ');
        }

        function reportIssue() {
            showActionModal('üö® Report Issue');
            speakInCurrentLanguage('Issue reporting system opened', '‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ñ‡•Å‡§≤‡§æ');
        }

        // Enhanced keyboard and event handling
        document.addEventListener('keydown', function(e) {
            // Close modals with Escape key
            if (e.key === 'Escape') {
                closeAllModals();
            }
        });

        // Prevent interface freezing by handling errors globally
        window.addEventListener('error', function(event) {
            console.error('JavaScript error caught:', event.error);
            showToast('An error occurred. Interface remains responsive.', 'error');
        });

        // Prevent unhandled promise rejections from freezing interface
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            event.preventDefault();
            showToast('Operation completed with warnings.', 'warning');
        });

        // Form submission handler
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault();

            try {
                const formData = {
                    name: document.getElementById('farmerName').value,
                    phone: document.getElementById('farmerPhone').value,
                    email: document.getElementById('farmerEmail').value,
                    location: document.getElementById('farmLocation').value,
                    size: document.getElementById('farmSize').value
                };

                console.log('Farmer registered:', formData);
                showToast('Farmer registered successfully!', 'success');
                speakInCurrentLanguage('Farmer registration completed successfully', '‡§ï‡§ø‡§∏‡§æ‡§® ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü');
            } catch (error) {
                console.error('Form submission error:', error);
                showToast('Registration form error. Please try again.', 'error');
            }
        });
    </script>
</body>
</html>